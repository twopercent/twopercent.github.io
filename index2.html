<!doctype html>
<html lang="">	
<head>
	<meta charset="utf-8"/>
	<title>twopercent</title>	
	<meta name="author" content="Chris Moser">
	

	<link rel="top" href="#" /><link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,300italic,400italic,600italic|Source+Code+Pro' rel='stylesheet' type='text/css'></link>
	<link rel="stylesheet" href="/theme/css/main.css" type="text/css" />
		

</head>
	
<body>

    <div class="container">
	  
	  <header role="banner">
	    <div class="feeds">
	    </div>
	      <nav class="pages">
			  <a href="/pages/resume.html">Resume</a>
	      </nav>
		<a href="" class="title">twopercent</a>
      </header>
	
	  <div class="wrapper">

		  <div role="main" class="content">



      <article>
        <h1><a href="/ansible-for-windows.html">Ansible for Windows</a></h1>
        <p>A co-worker of mine is using <a class="reference external" href="https://www.ansible.com/">Ansible</a> to manage some windows hosts.
I set up my own environment to do some testing for him.
Recently released Ansible 2.1 has some new features for Windows management so I installed this from epel-testing.
sshpass is also required.</p>
<div class="section" id="installation">
<h2>Installation</h2>
<p>On CentOS 7:</p>
<div class="highlight"><pre>sudo yum -y --enablerepo epel --enablerepo epel-testing install ansible sshpass
</pre></div>
<p>You will also need pywinrm as well:</p>
<div class="highlight"><pre>sudo pip install pywinrm
</pre></div>
</div>
<div class="section" id="configure-windows-clients">
<h2>Configure Windows Clients</h2>
<p>I followed the <a class="reference external" href="http://docs.ansible.com/ansible/intro_windows.html#windows-system-prep/">Windows System Prep</a> guide on <a class="reference external" href="http://docs.ansible.com/">docs.ansible.com</a>.
The first suggestion is to run a powershell script on each Windows host.
I have no reason to believe Ansible would be mailicious but I don't like the idea of running this script without needing to.
Getting started, we only need to verify that powershell 3.0.0 or later is installed and that the WinRM service is installed and running.
Open powershell and run the following commands:</p>
<div class="highlight"><pre><span class="nv">$PSVersionTable</span><span class="p">.</span><span class="n">PSVersion</span>
<span class="nb">Get-Service</span> <span class="s2">&quot;WinRM&quot;</span>
</pre></div>
<p>If powershell is too old or the WinRM service is not installed or not running, remedy these before moving on.</p>
<p>Create a local administrator account for Ansible to use.</p>
</div>
<div class="section" id="configure-ansible">
<h2>Configure Ansible</h2>
<p>Change to /etc/ansible and modify the &quot;hosts&quot; file.
Declare a [windows] group and list one or more Windows hosts.</p>
<div class="highlight"><pre><span class="o">[</span>windows<span class="o">]</span>
workPC.mydomain.com
homePC.mydonain.com
</pre></div>
<p>Create the /etc/ansible/group_vars directory and create a &quot;windows.yml&quot; file in it.
This will describe the local account to use, password, and connection settings.</p>
<div class="highlight"><pre><span class="l-Scalar-Plain">ansible_user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ansible</span>
<span class="l-Scalar-Plain">ansible_password</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">secret_password</span>
<span class="l-Scalar-Plain">ansible_port</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">5985</span>
<span class="l-Scalar-Plain">ansible_connection</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">winrm</span>
</pre></div>
<p>Port 5985 is the default http port for WS-Management.
We can switch to 5986 after an SSL certificate is arranged and installed.</p>
</div>
<div class="section" id="the-results">
<h2>The Results</h2>
<p>That should be all we need.
On the control server issue the following command:</p>
<div class="highlight"><pre>ansible windows -m win_ping
</pre></div>
<div class="highlight"><pre>workPC.mydomain.com <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: <span class="nb">false</span>,
    <span class="s2">&quot;ping&quot;</span>: <span class="s2">&quot;pong&quot;</span>
<span class="o">}</span>
homePC.mydomain.com <span class="p">|</span> <span class="nv">SUCCESS</span> <span class="o">=</span>&gt; <span class="o">{</span>
    <span class="s2">&quot;changed&quot;</span>: <span class="nb">false</span>,
    <span class="s2">&quot;ping&quot;</span>: <span class="s2">&quot;pong&quot;</span>
<span class="o">}</span>
</pre></div>
</div>

      </article>

      <hr />

        <div>
          <h3>Last posts</h3>
          <ol class="archive">
    


      <li>
<a href="/boinc-on-docker.html" rel="bookmark" title="Permalink to Boinc on Docker">Boinc on Docker</a>
  <time datetime="2016-03-15T17:07:00-05:00" pubdate>Tue 15 March 2016</time>
<p class="tags">tags: <a href="/tag/ops.html">ops</a><a href="/tag/centos.html">CentOS</a><a href="/tag/docker.html">docker</a><a href="/tag/boinc.html">BOINC</a></p></a>      </li>


      <li>
<a href="/marathon-part-1.html" rel="bookmark" title="Permalink to Marathon Part 1">Marathon Part 1</a>
  <time datetime="2016-03-08T11:58:00-06:00" pubdate>Tue 08 March 2016</time>
<p class="tags">tags: <a href="/tag/ops.html">ops</a><a href="/tag/mesos.html">mesos</a><a href="/tag/marathon.html">marathon</a><a href="/tag/zookeeper.html">zookeeper</a></p></a>      </li>


      <li>
<a href="/apache-aurora-tutorial.html" rel="bookmark" title="Permalink to Apache Aurora Tutorial">Apache Aurora Tutorial</a>
  <time datetime="2016-03-03T15:28:00-06:00" pubdate>Thu 03 March 2016</time>
<p class="tags">tags: <a href="/tag/ops.html">ops</a><a href="/tag/debian.html">debian</a><a href="/tag/mesos.html">mesos</a><a href="/tag/aurora.html">aurora</a><a href="/tag/vagrant.html">vagrant</a><a href="/tag/virtualbox.html">virtualbox</a></p></a>      </li>


      <li>
<a href="/apache-mesos-part-1.html" rel="bookmark" title="Permalink to Apache Mesos Part 1">Apache Mesos Part 1</a>
  <time datetime="2016-02-23T15:12:00-06:00" pubdate>Tue 23 February 2016</time>
<p class="tags">tags: <a href="/tag/ops.html">ops</a><a href="/tag/centos.html">CentOS</a><a href="/tag/mesos.html">mesos</a></p></a>      </li>


      <li>
<a href="/advent-of-code-2015.html" rel="bookmark" title="Permalink to Advent of Code 2015">Advent of Code 2015</a>
  <time datetime="2015-12-10T16:10:00-06:00" pubdate>Thu 10 December 2015</time>
<p class="tags">tags: <a href="/tag/dev.html">dev</a><a href="/tag/python.html">python</a></p></a>      </li>














          </ol>
        </div>

		  </div>	
		  
		  <div class="sidebar">

	        <nav>
	          <h2>Categories</h2>
	          <ul>
	              <li ><a href="/category/blog.html">blog</a></li>
	          </ul>
	        </nav>

	          <aside>
	          <h2>Social</h2>
			    <ul class="social">
				  <li><a href="http://github.com/twopercent">github</a><i></i></li>
				  <li><a href="http://twitter.com/dancingwstar">twitter</a><i></i></li>
				  <li><a href="https://www.linkedin.com/pub/chris-moser/43/738/932">linkedin</a><i></i></li>
			    </ul>
			  </aside>

	          <aside>
	            <h2>Blogroll</h2>
	            <ul>
	                <li><a href="http://getpelican.com/">Pelian</a></li>
	                <li><a href="http://python.org/">Python.org</a></li>
	                <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
	                <li><a href="http://neic.coop">NEIC</a></li>
	            </ul>
	          </aside>

		  </div>

	  </div>

      <footer>
		<p role="contentinfo">
		  Â© 2013 Chris Moser - Proudly powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>. Theme <a href="https://github.com/fle/pelican-simplegrey">pelican-simplegrey</a>.
    	</p>

	  </footer>	

	</div>
	

</body>
</html>